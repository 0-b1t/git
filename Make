#!/bin/sh

case "`uname -m 2>/dev/null`" in
x86_64)
	USE_PIC=YesPlease
	export USE_PIC
	;;
esac

# DDD=' -DUSE_SYMLINK_HEAD=0'
# PATH=/usr/bin:/bin
PATH=$HOME/bin/Linux:/usr/bin:/bin
LANG=C
LC_CTYPE=C
export PATH LANG LC_CTYPE

case "`git symbolic-ref HEAD`" in
refs/heads/next)
	d="bindir=$HOME/bin/Linux gitexecdir=$HOME/bin/Linux" ;;
refs/heads/maint)
	d="prefix=$HOME/git-maint" ;;
refs/heads/master)
	d="prefix=$HOME/git-master" ;;
refs/heads/pu)
	d="prefix=$HOME/git-pu" ;;
*)
	d="prefix=$HOME/git-test" ;;
esac

while case $# in 0) break ;; esac
do 
	case "$1" in
	-pedantic)
		O='-O2 -Werror -ansi -pedantic -std=c99 -D_XOPEN_SOURCE=500 -D_BSD_SOURCE'
		;;
	--)
		shift
		break
		;;
	-*)
		echo >&2 "Eh $1?"
		exit 1
		;;
	*)
		break
		;;		
	esac
	shift
done

: ${O=-O2}
make $d \
     PYTHON_PATH=/usr/bin/python2.4 \
     CFLAGS="$O -Wall -Wdeclaration-after-statement -g" \
     WITH_SEND_EMAIL=YesPlease \
     WITH_SVNIMPORT=YesPlease \
     "$@"
